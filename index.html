<!DOCTYPE html>
<html>

<head>
    <title>RSA Encryption</title>
</head>

<body>
    <h1>RSA Encryption</h1>
    <button onclick="generateKeys()">Generate Keys</button>
    <br>
    <label for="publicKey">Public Key (n, e):</label>
    <textarea id="publicKey" rows="3" cols="60" readonly></textarea>
    <br>
    <label for="privateKey">Private Key (n, d):</label>
    <textarea id="privateKey" rows="3" cols="60" readonly></textarea>
    <br>
    <label for="inputData">Input Data:</label>
    <textarea id="inputData" rows="10" cols="60"></textarea>
    <br>
    <button onclick="encryptData()">Encrypt Data</button>
    <button onclick="decryptData()">Decrypt Data</button>
    <br>
    <label for="encryptedData">Encrypted Data:</label>
    <textarea id="encryptedData" rows="10" cols="60" readonly></textarea>
    <br>
    <label for="decryptedData">Decrypted Data:</label>
    <textarea id="decryptedData" rows="10" cols="60" readonly></textarea>

    <script src="PrimeNumber.js"> </script>

    <script src="MyMath.js"></script>

    <script src="Key.js"></script>

    <script>
        let publicKey, privateKey;
        // Hàm xử lý khi người dùng nhấn nút Generate Keys
        function generateKeys() {
            const keySize = 1024;
            generateRSAKeyPair(keySize);
            document.getElementById('publicKey').value = "n: " + publicKey.n + "\ne:" + publicKey.e;
            document.getElementById('privateKey').value = "n: " + privateKey.n + "\nd:" + privateKey.d;
        }

        // Hàm mã hóa dữ liệu sử dụng khóa công khai RSA
        function encrypt(publicKey, data) {
            const e = publicKey.e,
                n = publicKey.n;
            const encryptedData = data.split('').map(char => powerMod(BigInt(char.charCodeAt(0)), BigInt(e), BigInt(n)));
            return encryptedData;
        }

        // Hàm xử lý khi người dùng nhấn nút Encrypt Data
        function encryptData() {
            const inputData = document.getElementById('inputData').value;
            const encryptedData = encryptRSA(publicKey, inputData);
            document.getElementById('encryptedData').value = encryptedData.join('\n');
        }

        // Hàm giải mã RSA
        function decrypt(encryptedData, key) {
            const d = key.d;
            const n = key.n;
            const result = [];
            const temp = encryptedData.split("\n")
            for (const char of temp) {
                const decryptedChar = String.fromCharCode(BigInt(char) ** BigInt(d) % BigInt(n));
                result.push(decryptedChar);
            }
            return result.join('');
        }

        // Hàm xử lý khi người dùng nhấn nút Decrypt Data
        function decryptData() {
            const encryptedData = document.getElementById('inputData').value;
            const decryptedData = decrypt(encryptedData, privateKey);

            document.getElementById('decryptedData').value = decryptedData;
        }

        // Hàm chuyển đổi ArrayBuffer sang dạng số nguyên dương hệ thập phân
        function arrayBufferToDecimal(arrayBuffer) {
            let decimal = 0;
            const bytes = new Uint8Array(arrayBuffer);
            for (let i = 0; i < bytes.length; i++) {
                decimal = decimal * 256 + bytes[i];
            }
            return decimal;
        }

        // Hàm chuyển đổi dạng số nguyên dương hệ thập phân sang ArrayBuffer
        function decimalToArrayBuffer(decimal) {
            const bytes = [];
            while (decimal > 0) {
                bytes.unshift(decimal % 256);
                decimal = Math.floor(decimal / 256);
            }
            return new Uint8Array(bytes);
        }
    </script>
</body>

</html>